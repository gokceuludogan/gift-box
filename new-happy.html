<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random New Happy Post (Live)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #fdfbf7;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }
        .card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 90%;
            border: 2px solid #333;
        }
        h1 { margin-top: 0; color: #333; }
        p { color: #666; margin-bottom: 2rem; }
        
        button {
            background-color: #ffcb05;
            color: #333;
            border: 2px solid #333;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            width: 100%;
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.98); }
        button:disabled { background-color: #ddd; cursor: wait; }

        #status {
            margin-top: 15px;
            font-size: 0.9rem;
            min-height: 1.2em;
            color: #555;
        }
        .error { color: #d32f2f !important; }
    </style>
</head>
<body>

<div class="card">
    <h1>New Happy Randomizer</h1>
    <p>Fetches the live sitemap to find a random post.</p>
    
    <button id="btn" onclick="fetchAndGo()">Go to Random Post</button>
    <div id="status"></div>
</div>

<script>
    async function fetchAndGo() {
        const btn = document.getElementById('btn');
        const status = document.getElementById('status');
        
        btn.disabled = true;
        status.textContent = "Scanning site map...";
        status.className = "";

        // We use 'allorigins' proxy to bypass CORS restrictions
        // This allows this static file to read the external sitemap
        const sitemapUrl = 'https://www.thenewhappy.com/sitemap.xml';
        //const proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent(sitemapUrl);
        const proxyUrl = 'https://api.codetabs.com/v1/proxy/?quest=' + encodeURIComponent(sitemapUrl);


        try {
            const response = await fetch(proxyUrl);
            if (!response.ok) throw new Error("Network response was not ok");
            
            const text = await response.text();
            
            // Parse XML to find URLs
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(text, "text/xml");
            const locs = xmlDoc.getElementsByTagName("loc");
            
            // Filter specifically for /blog/ links
            let links = [];
            for (let i = 0; i < locs.length; i++) {
                const url = locs[i].textContent;
                // Exclude the main blog index page, only get individual posts
                if (url.includes('/blog/') && url !== 'https://www.thenewhappy.com/blog') {
                    links.push(url);
                }
            }

            if (links.length === 0) {
                throw new Error("No blog links found in sitemap.");
            }

            // Pick random
            const randomLink = links[Math.floor(Math.random() * links.length)];
            
            status.textContent = "Found " + links.length + " posts. Redirecting...";
            
            // Redirect
            window.location.href = randomLink;

        } catch (error) {
            console.error(error);
            status.textContent = "Error: Could not fetch sitemap. (Proxy might be busy)";
            status.className = "error";
            btn.disabled = false;
        }
    }
</script>

</body>
</html>
